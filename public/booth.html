<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The Pub Booth Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: url('https://assets.andythornton.com/images/blakes-sports-bar/sports-bar-furniture-3.jpg') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      font-family: 'Roboto', sans-serif;
    }
    .booth-bg {
      background: rgba(30, 18, 7, 0.97);
      border-radius: 2rem;
      box-shadow: 0 8px 40px 0 rgba(0,0,0,0.7);
      border: 5px solid #b1884b;
      backdrop-filter: blur(3px);
    }
    .booth-top {
      background: linear-gradient(90deg, #7b5a3b 0%, #a6743e 50%, #7b5a3b 100%);
      border-top-left-radius: 2rem;
      border-top-right-radius: 2rem;
      min-height: 48px;
    }
    .bar-stool {
      width: 36px; height: 36px; background: #deb887; border-radius: 50%; margin: 6px;
      border: 2px solid #b1884b;
      box-shadow: 0 2px 8px 0 rgba(0,0,0,0.25);
      display: inline-block;
    }
    .booth-bg select,
    .booth-bg input {
      background: #2b2117 !important;
      color: #ffe4b5 !important;
      border-color: #b1884b !important;
    }
    .booth-bg input::placeholder {
      color: #d0b57a !important;
    }
    .booth-bg label {
      color: #ffe4b5 !important;
    }
    .booth-bg .bg-amber-50\/80 {
      background-color: rgba(56, 27, 0, 0.5) !important;
    }
    .booth-bg .border-yellow-600 {
      border-color: #b1884b !important;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen">
  <div class="flex flex-col items-center mt-8">
    <div class="booth-bg w-full max-w-lg mx-auto">
      <div class="booth-top flex items-center justify-between px-6 py-3">
        <div class="flex items-center gap-2">
          <h1 class="text-2xl font-montserrat font-bold text-yellow-100 drop-shadow">üçª Booths</h1>
        </div>
        <div class="flex items-center gap-2">
          <a href="index.html" class="bg-yellow-700 hover:bg-yellow-800 text-white font-bold py-1 px-3 rounded-lg shadow text-base transition duration-150 border-2 border-yellow-300">Home</a>
        </div>
      </div>
      <div id="authSection" class="p-6 flex flex-col items-center space-y-3">
        <button id="signInBtn" class="bg-yellow-700 hover:bg-yellow-800 text-white font-bold py-2 px-4 rounded-lg shadow-lg text-lg">Sign in with Google</button>
      </div>
      <div id="chatSection" class="hidden flex flex-col h-[60vh] px-6 pb-6">
        <div class="flex flex-col items-center mb-3">
          <label class="text-yellow-100 font-bold text-lg mb-2" for="boothSelect">Hop in a Group!</label>
          <select id="boothSelect" class="bg-yellow-100 border-2 border-yellow-700 rounded p-2 mb-2 w-full text-center font-bold" style="max-width: 400px;">
            <option value="vikings-steelers">Minnesota Vikings vs. Pittsburgh Steelers (9:30 AM EDT, NFL Network)</option>
            <option value="commanders-falcons">Washington Commanders vs. Atlanta Falcons (1:00 PM EDT, CBS)</option>
            <option value="saints-bills">New Orleans Saints vs. Buffalo Bills (1:00 PM EDT, CBS)</option>
            <option value="browns-lions">Cleveland Browns vs. Detroit Lions (1:00 PM EDT, FOX)</option>
            <option value="titans-texans">Tennessee Titans vs. Houston Texans (1:00 PM EDT, CBS)</option>
            <option value="panthers-patriots">Carolina Panthers vs. New England Patriots (1:00 PM EDT, FOX)</option>
            <option value="chargers-giants">Los Angeles Chargers vs. New York Giants (1:00 PM EDT, CBS)</option>
            <option value="eagles-buccaneers">Philadelphia Eagles vs. Tampa Bay Buccaneers (1:00 PM EDT, FOX)</option>
            <option value="colts-rams">Indianapolis Colts vs. Los Angeles Rams (4:05 PM EDT, FOX)</option>
            <option value="jaguars-49ers">Jacksonville Jaguars vs. San Francisco 49ers (4:05 PM EDT, FOX)</option>
            <option value="ravens-chiefs">Baltimore Ravens vs. Kansas City Chiefs (4:25 PM EDT, CBS)</option>
            <option value="bears-raiders">Chicago Bears vs. Las Vegas Raiders (4:25 PM EDT, CBS)</option>
            <option value="packers-cowboys">Green Bay Packers vs. Dallas Cowboys (8:20 PM EDT, NBC/UNIVERSO)</option>
            <option value="jets-dolphins">New York Jets vs. Miami Dolphins (Monday, 7:15 PM EDT, ESPN/ESPN Deportes)</option>
            <option value="bengals-broncos">Cincinnati Bengals vs. Denver Broncos (Monday, 8:15 PM EDT, ABC)</option>
          </select>
        </div>
        <div id="messages" class="flex-1 overflow-y-auto bg-amber-50/80 rounded-lg p-4 mb-2 border-2 border-yellow-600 shadow-inner"></div>
        <form id="messageForm" class="flex items-center gap-2">
          <input id="messageInput" type="text" required maxlength="240"
            class="flex-1 bg-white border-2 border-yellow-600 rounded-lg p-2 focus:outline-none focus:ring-yellow-800"
            placeholder="Type your message..."/>
          <button type="submit" class="bg-yellow-800 hover:bg-yellow-900 text-white font-bold py-2 px-4 rounded-lg shadow">Send</button>
        </form>
      </div>
    </div>
    <div class="flex items-end mt-4" id="barStools">
      <div class="bar-stool"></div>
      <div class="bar-stool"></div>
      <div class="bar-stool"></div>
      <div class="bar-stool"></div>
    </div>
    <p class="text-yellow-200 mt-2 text-sm" style="text-shadow: 1px 1px 6px #000;">The Pub &mdash; Pop a squat, pick a game, and talk shit!</p>
  </div>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script>
    // NFL games for Week 4, 2025
    const nflGames = [
      { id: "vikings-steelers", label: "Minnesota Vikings vs. Pittsburgh Steelers (9:30 AM EDT, NFL Network)" },
      { id: "commanders-falcons", label: "Washington Commanders vs. Atlanta Falcons (1:00 PM EDT, CBS)" },
      { id: "saints-bills", label: "New Orleans Saints vs. Buffalo Bills (1:00 PM EDT, CBS)" },
      { id: "browns-lions", label: "Cleveland Browns vs. Detroit Lions (1:00 PM EDT, FOX)" },
      { id: "titans-texans", label: "Tennessee Titans vs. Houston Texans (1:00 PM EDT, CBS)" },
      { id: "panthers-patriots", label: "Carolina Panthers vs. New England Patriots (1:00 PM EDT, FOX)" },
      { id: "chargers-giants", label: "Los Angeles Chargers vs. New York Giants (1:00 PM EDT, CBS)" },
      { id: "eagles-buccaneers", label: "Philadelphia Eagles vs. Tampa Bay Buccaneers (1:00 PM EDT, FOX)" },
      { id: "colts-rams", label: "Indianapolis Colts vs. Los Angeles Rams (4:05 PM EDT, FOX)" },
      { id: "jaguars-49ers", label: "Jacksonville Jaguars vs. San Francisco 49ers (4:05 PM EDT, FOX)" },
      { id: "ravens-chiefs", label: "Baltimore Ravens vs. Kansas City Chiefs (4:25 PM EDT, CBS)" },
      { id: "bears-raiders", label: "Chicago Bears vs. Las Vegas Raiders (4:25 PM EDT, CBS)" },
      { id: "packers-cowboys", label: "Green Bay Packers vs. Dallas Cowboys (8:20 PM EDT, NBC/UNIVERSO)" },
      { id: "jets-dolphins", label: "New York Jets vs. Miami Dolphins (Monday, 7:15 PM EDT, ESPN/ESPN Deportes)" },
      { id: "bengals-broncos", label: "Cincinnati Bengals vs. Denver Broncos (Monday, 8:15 PM EDT, ABC)" }
    ];

    // Firebase config (replace with your actual config if needed)
    const firebaseConfig = {
      apiKey: "AIzaSyBtsOBlh52YZagsLXp9_dcCq4qhkHBSWnU",
      authDomain: "thepub-sigma.firebaseapp.com",
      projectId: "thepub-sigma",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // DOM elements
    const authSection = document.getElementById('authSection');
    const signInBtn = document.getElementById('signInBtn');
    const chatSection = document.getElementById('chatSection');
    const messageForm = document.getElementById('messageForm');
    const messageInput = document.getElementById('messageInput');
    const messagesDiv = document.getElementById('messages');
    const boothSelect = document.getElementById('boothSelect');
    const barStools = document.getElementById('barStools');

    // Populate boothSelect with NFL games
    function populateBooths() {
      boothSelect.innerHTML = nflGames.map(game =>
        `<option value="${game.id}">${game.label}</option>`
      ).join('');
    }
    populateBooths();

    let user = null;
    let unsubscribe = null;
    let currentBooth = boothSelect.value;

    // Auth
    firebase.auth().onAuthStateChanged(u => {
      user = u;
      if (user) {
        authSection.classList.add('hidden');
        chatSection.classList.remove('hidden');
        joinBooth(currentBooth);
      } else {
        chatSection.classList.add('hidden');
        authSection.classList.remove('hidden');
      }
    });

    signInBtn.onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithPopup(provider);
    };

    boothSelect.onchange = () => {
      currentBooth = boothSelect.value;
      joinBooth(currentBooth);
    };

    function joinBooth(boothId) {
      // Unsubscribe previous listener if any
      if (unsubscribe) unsubscribe();
      messagesDiv.innerHTML = '<div class="text-center text-yellow-700 italic my-2">Loading messages...</div>';
      // Listen for last 50 messages in this booth, ordered by time
      unsubscribe = db.collection('booths')
        .doc(boothId)
        .collection('messages')
        .orderBy('timestamp', 'asc')
        .limitToLast(50)
        .onSnapshot(snap => {
          messagesDiv.innerHTML = "";
          let usersInBooth = {};
          snap.forEach(doc => {
            const msg = doc.data();
            usersInBooth[msg.uid] = msg.displayName || "Someone";
            const isMine = user && msg.uid === user.uid;
            const bubbleClasses = isMine
              ? "bg-yellow-700 text-right ml-10"
              : "bg-yellow-100 text-left mr-10";
            messagesDiv.innerHTML += `
              <div class="mb-2">
                <span class="block text-xs text-yellow-700 ${isMine ? 'text-right' : ''}">
                  ${msg.displayName || "Someone"} 
                  <span class="text-yellow-400">${msg.time || ""}</span>
                </span>
                <div class="inline-block px-3 py-2 rounded-lg shadow-sm ${bubbleClasses}">${msg.text}</div>
              </div>
            `;
          });
          // Update "bar stools" with avatars
          barStools.innerHTML = Object.keys(usersInBooth).slice(0,4).map(uid => `
            <img src="https://robohash.org/${uid}?set=set5&size=36x36" title="${usersInBooth[uid]}" class="rounded-full border-2 border-yellow-700 shadow bar-stool" />
          `).join('');
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    }

    messageForm.onsubmit = async (e) => {
      e.preventDefault();
      const text = messageInput.value.trim();
      if (!text) return;
      await db.collection('booths')
        .doc(currentBooth)
        .collection('messages')
        .add({
          text: text,
          uid: user.uid,
          displayName: user.displayName,
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
        });
      messageInput.value = "";
    };
  </script>
</body>
</html>
