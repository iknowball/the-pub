<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>The Pub Booth Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg,#1a1e2d 0%,#2d3246 100%);
      min-height: 100vh;
      font-family: 'Roboto', 'Montserrat', sans-serif;
    }
    .booth-bg {
      background: #23263a;
      border-radius: 1.5rem;
      box-shadow: 0 8px 40px 0 rgba(0,0,0,0.4);
      border: 0;
      backdrop-filter: blur(2px);
    }
    .booth-top {
      background: linear-gradient(90deg, #2c2f48 0%, #3c4062 100%);
      border-top-left-radius: 1.5rem;
      border-top-right-radius: 1.5rem;
      min-height: 48px;
      border-bottom: 1px solid #23263a;
    }
    .bar-stool {
      width: 36px; height: 36px; background: #314276; border-radius: 50%; margin: 6px;
      border: 2px solid #3c4062;
      box-shadow: 0 2px 8px 0 rgba(0,0,0,0.18);
      display: inline-block;
    }
    .booth-bg select,
    .booth-bg input {
      background: #292c40 !important;
      color: #e8eefd !important;
      border-color: #3c4062 !important;
    }
    .booth-bg input::placeholder {
      color: #8695b8 !important;
    }
    .booth-bg label {
      color: #e8eefd !important;
    }
    .booth-bg .border-blue-600 {
      border-color: #314276 !important;
    }
    .twitter-chat-bubble {
      background: #23263a;
      border-radius: 1rem;
      box-shadow: 0 2px 8px rgba(44,64,98,0.09);
      padding: 12px 18px;
      margin-bottom: 12px;
      position: relative;
      max-width: 460px;
      word-break: break-word;
      transition: background 0.2s;
    }
    .twitter-chat-bubble.mine {
      background: #314276;
      color: #fff;
    }
    .twitter-chat-bubble .username {
      font-weight: 700;
      color: #4d67a3;
      font-family: 'Montserrat',sans-serif;
    }
    .twitter-chat-bubble.mine .username {
      color: #ffe477;
    }
    .twitter-chat-bubble .timestamp {
      font-size: 0.85em;
      color: #b9c5e1;
      margin-left: 8px;
    }
    /* Add hover effect */
    .twitter-chat-bubble:hover {
      background: #292c40;
    }
    /* Scrollbar styling */
    #messages::-webkit-scrollbar {
      width: 7px;
      background: #23263a;
    }
    #messages::-webkit-scrollbar-thumb {
      background: #314276;
      border-radius: 6px;
    }
  </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen">
  <div class="flex flex-col items-center mt-8">
    <div class="booth-bg w-full max-w-2xl mx-auto">
      <div class="booth-top flex items-center justify-between px-6 py-3">
        <div class="flex items-center gap-2">
          <h1 class="text-2xl font-montserrat font-bold text-blue-100 drop-shadow">üèà Game Booths</h1>
        </div>
        <div class="flex items-center gap-2">
          <a href="index.html" class="bg-blue-700 hover:bg-blue-800 text-white font-bold py-1 px-3 rounded-lg shadow text-base transition duration-150 border-2 border-blue-300">Home</a>
        </div>
      </div>
      <div id="chatSection" class="flex flex-col h-[60vh] px-6 pb-6">
        <div class="flex flex-col items-center mb-3">
          <label class="text-blue-100 font-bold text-lg mb-2" for="usernameInput">Your Username (optional):</label>
          <input id="usernameInput" type="text" maxlength="20" class="bg-blue-100 border-2 border-blue-700 rounded p-2 mb-2 w-full text-center font-bold" style="max-width: 400px;" placeholder="Anonymous"/>
          <label class="text-blue-100 font-bold text-lg mb-2" for="boothSelect">Pick a Game Booth</label>
          <select id="boothSelect" class="bg-blue-100 border-2 border-blue-700 rounded p-2 mb-2 w-full text-center font-bold" style="max-width: 400px;">
            <option value="vikings-steelers">Minnesota Vikings vs. Pittsburgh Steelers (9:30 AM EDT, NFL Network)</option>
            <option value="commanders-falcons">Washington Commanders vs. Atlanta Falcons (1:00 PM EDT, CBS)</option>
            <option value="saints-bills">New Orleans Saints vs. Buffalo Bills (1:00 PM EDT, CBS)</option>
            <option value="browns-lions">Cleveland Browns vs. Detroit Lions (1:00 PM EDT, FOX)</option>
            <option value="titans-texans">Tennessee Titans vs. Houston Texans (1:00 PM EDT, CBS)</option>
            <option value="panthers-patriots">Carolina Panthers vs. New England Patriots (1:00 PM EDT, FOX)</option>
            <option value="chargers-giants">Los Angeles Chargers vs. New York Giants (1:00 PM EDT, CBS)</option>
            <option value="eagles-buccaneers">Philadelphia Eagles vs. Tampa Bay Buccaneers (1:00 PM EDT, FOX)</option>
            <option value="colts-rams">Indianapolis Colts vs. Los Angeles Rams (4:05 PM EDT, FOX)</option>
            <option value="jaguars-49ers">Jacksonville Jaguars vs. San Francisco 49ers (4:05 PM EDT, FOX)</option>
            <option value="ravens-chiefs">Baltimore Ravens vs. Kansas City Chiefs (4:25 PM EDT, CBS)</option>
            <option value="bears-raiders">Chicago Bears vs. Las Vegas Raiders (4:25 PM EDT, CBS)</option>
            <option value="packers-cowboys">Green Bay Packers vs. Dallas Cowboys (8:20 PM EDT, NBC/UNIVERSO)</option>
            <option value="jets-dolphins">New York Jets vs. Miami Dolphins (Monday, 7:15 PM EDT, ESPN/ESPN Deportes)</option>
            <option value="bengals-broncos">Cincinnati Bengals vs. Denver Broncos (Monday, 8:15 PM EDT, ABC)</option>
          </select>
        </div>
        <div id="messages" class="flex-1 overflow-y-auto px-0 pb-2 pt-2 rounded-lg mb-2 border-2 border-blue-600 shadow-inner bg-[#23263a]"></div>
        <form id="messageForm" class="flex items-center gap-2 mt-2">
          <input id="messageInput" type="text" required maxlength="240"
            class="flex-1 bg-[#292c40] border-2 border-blue-600 rounded-lg p-2 focus:outline-none focus:ring-blue-800 text-white"
            placeholder="What's happening in your game booth?"/>
          <button type="submit" class="bg-blue-800 hover:bg-blue-900 text-white font-bold py-2 px-4 rounded-lg shadow">Send</button>
        </form>
      </div>
    </div>
    <div class="flex items-end mt-4" id="barStools">
      <div class="bar-stool"></div>
      <div class="bar-stool"></div>
      <div class="bar-stool"></div>
      <div class="bar-stool"></div>
    </div>
    <p class="text-blue-200 mt-2 text-sm" style="text-shadow: 1px 1px 6px #000;">The Pub &mdash; Pick a game, chat, and react like Twitter!</p>
  </div>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    // NFL games for Week 4, 2025
    const nflGames = [
      { id: "vikings-steelers", label: "Minnesota Vikings vs. Pittsburgh Steelers (9:30 AM EDT, NFL Network)" },
      { id: "commanders-falcons", label: "Washington Commanders vs. Atlanta Falcons (1:00 PM EDT, CBS)" },
      { id: "saints-bills", label: "New Orleans Saints vs. Buffalo Bills (1:00 PM EDT, CBS)" },
      { id: "browns-lions", label: "Cleveland Browns vs. Detroit Lions (1:00 PM EDT, FOX)" },
      { id: "titans-texans", label: "Tennessee Titans vs. Houston Texans (1:00 PM EDT, CBS)" },
      { id: "panthers-patriots", label: "Carolina Panthers vs. New England Patriots (1:00 PM EDT, FOX)" },
      { id: "chargers-giants", label: "Los Angeles Chargers vs. New York Giants (1:00 PM EDT, CBS)" },
      { id: "eagles-buccaneers", label: "Philadelphia Eagles vs. Tampa Bay Buccaneers (1:00 PM EDT, FOX)" },
      { id: "colts-rams", label: "Indianapolis Colts vs. Los Angeles Rams (4:05 PM EDT, FOX)" },
      { id: "jaguars-49ers", label: "Jacksonville Jaguars vs. San Francisco 49ers (4:05 PM EDT, FOX)" },
      { id: "ravens-chiefs", label: "Baltimore Ravens vs. Kansas City Chiefs (4:25 PM EDT, CBS)" },
      { id: "bears-raiders", label: "Chicago Bears vs. Las Vegas Raiders (4:25 PM EDT, CBS)" },
      { id: "packers-cowboys", label: "Green Bay Packers vs. Dallas Cowboys (8:20 PM EDT, NBC/UNIVERSO)" },
      { id: "jets-dolphins", label: "New York Jets vs. Miami Dolphins (Monday, 7:15 PM EDT, ESPN/ESPN Deportes)" },
      { id: "bengals-broncos", label: "Cincinnati Bengals vs. Denver Broncos (Monday, 8:15 PM EDT, ABC)" }
    ];

    // Firebase config (replace with your actual config if needed)
    const firebaseConfig = {
      apiKey: "AIzaSyBtsOBlh52YZagsLXp9_dcCq4qhkHBSWnU",
      authDomain: "thepub-sigma.firebaseapp.com",
      projectId: "thepub-sigma",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // DOM elements
    const messageForm = document.getElementById('messageForm');
    const messageInput = document.getElementById('messageInput');
    const messagesDiv = document.getElementById('messages');
    const boothSelect = document.getElementById('boothSelect');
    const barStools = document.getElementById('barStools');
    const usernameInput = document.getElementById('usernameInput');

    // Populate boothSelect with NFL games
    function populateBooths() {
      boothSelect.innerHTML = nflGames.map(game =>
        `<option value="${game.id}">${game.label}</option>`
      ).join('');
    }
    populateBooths();

    let unsubscribe = null;
    let currentBooth = boothSelect.value;

    boothSelect.onchange = () => {
      currentBooth = boothSelect.value;
      joinBooth(currentBooth);
    };

    function joinBooth(boothId) {
      if (unsubscribe) unsubscribe();
      messagesDiv.innerHTML = '<div class="text-center text-blue-400 italic my-2">Loading messages...</div>';
      unsubscribe = db.collection('booths')
        .doc(boothId)
        .collection('messages')
        .orderBy('timestamp', 'asc')
        .limitToLast(50)
        .onSnapshot(snap => {
          messagesDiv.innerHTML = "";
          let usersInBooth = {};
          snap.forEach(doc => {
            const msg = doc.data();
            // Use displayName, default to Anonymous
            const displayName = msg.displayName || "Anonymous";
            usersInBooth[msg.displayName || msg.uid || "Anonymous"] = displayName;
            // If mine, compare to session username
            const sessionUsername = usernameInput.value.trim() || "Anonymous";
            const isMine = displayName === sessionUsername;
            messagesDiv.innerHTML += `
              <div class="twitter-chat-bubble${isMine ? " mine ml-auto" : ""}">
                <span class="username">${displayName}</span>
                <span class="timestamp">${msg.time || ""}</span>
                <div>${msg.text}</div>
              </div>
            `;
          });
          barStools.innerHTML = Object.keys(usersInBooth).slice(0,4).map(uid => `
            <img src="https://robohash.org/${uid}?set=set5&size=36x36" title="${usersInBooth[uid]}" class="rounded-full border-2 border-blue-700 shadow bar-stool" />
          `).join('');
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    }
    // Initial booth join
    joinBooth(currentBooth);

    messageForm.onsubmit = async (e) => {
      e.preventDefault();
      const text = messageInput.value.trim();
      if (!text) return;
      // Use username if provided, else Anonymous
      const displayName = usernameInput.value.trim() || "Anonymous";
      await db.collection('booths')
        .doc(currentBooth)
        .collection('messages')
        .add({
          text: text,
          displayName: displayName,
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
        });
      messageInput.value = "";
    };
  </script>
</body>
</html>
